<?xml version="1.0"?>
<launch>

    <!-- ARGUMENTS - LAUNCH FILE -->
    <arg name="nodelet"   default="true"/>
    <arg name="nn_enable" default="true"/>
    <arg name="nn_model"  default="mobilenet" doc="NN model [mobilenet, yolov4]"/>

    <!-- ARGUMENTS - OAKD CAMERA PARAMS -->
    <arg name="camera_name"  default="oakd" />
    <arg name="camera_param_uri" default="package://depthai_nodes/params/camera" />
    
    <!-- ARGUMENTS - OAKD NODE/NODELET -->
    <arg name="mode"     default="depth"/> <!-- depth or disparity -->
    <arg name="sync_nn"  default="true"/>
    <arg name="lrcheck"  default="false" /> 
    <arg name="extended" default="false" /> 
    <arg name="subpixel" default="false" />
    
    <!-- AI DETECTIONS ENABLED -->
    <group if="$(arg nn_enable)">
        <!-- OAKD RGB + DEPTH + SPATIAL AI NODELET -->
        <group if="$(arg nodelet)">
            <node pkg="nodelet" type="nodelet" name="nodelet_manager"  args="manager" output="screen"/>

            <node name="rgbd_pub" pkg="nodelet" type="nodelet" output="screen" required="true"
                args="load depthai_nodes/rgbd_$(arg nn_model)_nodelet nodelet_manager">
                <param name="camera_name" value="$(arg camera_name)"/>
                <param name="camera_param_uri" value="$(arg camera_param_uri)"/>
                <param name="sync_nn" value="$(arg sync_nn)"/>
                <param name="lrcheck" value="$(arg lrcheck)"/>
                <param name="extended" value="$(arg extended)"/>
                <param name="subpixel" value="$(arg subpixel)"/>
            </node>  
        </group>   
    
        <!-- OAKD RGB + DEPTH + SPATIAL AI NODE -->
        <group unless="$(arg nodelet)">
            <!-- launch-prefix="xterm -e gdb (add [- - args] without space) -->
            <node name="rgbd_pub" pkg="depthai_nodes" type="rgbd_$(arg nn_model)_node" output="screen" required="true">
                <param name="camera_name" value="$(arg camera_name)"/>
                <param name="camera_param_uri" value="$(arg camera_param_uri)"/>
                <param name="sync_nn" value="$(arg sync_nn)"/>
                <param name="lrcheck" value="$(arg lrcheck)"/>
                <param name="extended" value="$(arg extended)"/>
                <param name="subpixel" value="$(arg subpixel)"/>
            </node>         
        </group>
    </group>
    
    <!-- AI DETECTIONS DISABLED -->
    <group unless="$(arg nn_enable)">
        <!-- OAKD RGB + DEPTH/DISPARITY NODELET -->
        <group if="$(arg nodelet)">
            <node pkg="nodelet" type="nodelet" name="nodelet_manager"  args="manager" output="screen"/>

            <node name="rgbd_pub" pkg="nodelet" type="nodelet" output="screen" required="true"
                args="load depthai_nodes/rgbd_nodelet nodelet_manager">
                <param name="camera_name" value="$(arg camera_name)"/>
                <param name="camera_param_uri" value="$(arg camera_param_uri)"/>
                <param name="mode" value="$(arg mode)"/>
                <param name="lrcheck" value="$(arg lrcheck)"/>
                <param name="extended" value="$(arg extended)"/>
                <param name="subpixel" value="$(arg subpixel)"/>
            </node> 
        </group> 
        
        <!-- OAKD RGB + DEPTH/DISPARITY NODE -->
        <group unless="$(arg nodelet)">
            <!-- launch-prefix="xterm -e gdb (add [- - args] without space) -->
            <node name="rgbd_pub" pkg="depthai_nodes" type="rgbd_node" output="screen" required="true">
                <param name="camera_name" value="$(arg camera_name)"/>
                <param name="camera_param_uri" value="$(arg camera_param_uri)"/>
                <param name="mode" value="$(arg mode)"/>
                <param name="lrcheck" value="$(arg lrcheck)"/>
                <param name="extended" value="$(arg extended)"/>
                <param name="subpixel" value="$(arg subpixel)"/>
            </node>         
        </group>    
    </group>

</launch>

