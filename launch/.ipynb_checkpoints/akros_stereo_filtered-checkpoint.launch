<?xml version="1.0"?>
<launch>

    <include file="$(find akros_test)/launch/pointcloud_stereo.launch" /> 
    <arg name="nodeName" default="stereo_pub"/>
    
    <!-- Run a StatisticalOutlierRemoval filter to clean the data -->
    <node pkg="nodelet" type="nodelet" name="outlier_rem" args="load pcl/StatisticalOutlierRemoval pointcloud_manager" output="screen">
        <remap from="~input" to="/$(arg nodeName)/stereo/points" />
        <rosparam>
          mean_k: 2
          stddev: 0.01
          negative: False
        </rosparam>
    </node>
    
    <!-- Run a VoxelGrid filter to clean the outlier-removed data and downsample it -->
    <node pkg="nodelet" type="nodelet" name="voxel_grid_outlier" args="load pcl/VoxelGrid pointcloud_manager" output="screen">
        <remap from="~input" to="/outlier_rem/output" />
        <rosparam>
          filter_field_name: z
          filter_limit_min: 0.01
          filter_limit_max: 5
          filter_limit_negative: False
          leaf_size: 0.01
        </rosparam>
    </node>
    
    <!-- Run a VoxelGrid filter to clean the NaNs and downsample the data -->
    <node pkg="nodelet" type="nodelet" name="voxel_grid" args="load pcl/VoxelGrid pointcloud_manager" output="screen">
        <remap from="~input" to="/$(arg nodeName)/stereo/points" />
        <rosparam>
          filter_field_name: z
          filter_limit_min: 0.01
          filter_limit_max: 5
          filter_limit_negative: False
          leaf_size: 0.01
        </rosparam>
    </node>

    <!-- Run a passthrough filter to clean NaNs -->
    <node pkg="nodelet" type="nodelet" name="passthrough" args="load pcl/PassThrough pointcloud_manager" output="screen">
        <remap from="~input" to="/$(arg nodeName)/stereo/points" />
        <rosparam>
          filter_field_name: z
          filter_limit_min: 0.01
          filter_limit_max: 10
          filter_limit_negative: False
        </rosparam>
    </node>
    
</launch>
